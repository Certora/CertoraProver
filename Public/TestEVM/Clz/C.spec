methods {
    function clz(uint256) external returns (uint256) envfree;
}

rule clz() {
    uint256 x = 127;
    uint256 r = clz(x);
    assert r <= 256;
    mathint bound = 2^(256 - r);
    assert x < bound;
    assert x >= bound / 2;
}

rule clz_tests {
    // https://eips.ethereum.org/EIPS/eip-7939#test-cases
    assert clz(0x0000000000000000000000000000000000000000000000000000000000000000) == 0x0000000000000000000000000000000000000000000000000000000000000100;
    assert clz(0x8000000000000000000000000000000000000000000000000000000000000000) == 0x0000000000000000000000000000000000000000000000000000000000000000;
    assert clz(0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff) == 0x0000000000000000000000000000000000000000000000000000000000000000;
    assert clz(0x4000000000000000000000000000000000000000000000000000000000000000) == 0x0000000000000000000000000000000000000000000000000000000000000001;
    assert clz(0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff) == 0x0000000000000000000000000000000000000000000000000000000000000001;
    assert clz(0x0000000000000000000000000000000000000000000000000000000000000001) == 0x00000000000000000000000000000000000000000000000000000000000000ff;
}
